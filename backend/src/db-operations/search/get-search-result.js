import { ChatOpenAI, OpenAIEmbeddings } from "@langchain/openai";
import { formatDocumentsAsString } from "langchain/util/document";
import { StringOutputParser } from "@langchain/core/output_parsers";
import { RunnableSequence, RunnablePassthrough } from "@langchain/core/runnables";
import { PromptTemplate } from "@langchain/core/prompts";
import { Chroma } from "@langchain/community/vectorstores/chroma";
import config from './config.json' assert { type: "json" };

let vectorStore = null;

const getVectorStore = async function() {
    if (vectorStore == null) {
        vectorStore = await Chroma.fromExistingCollection(new OpenAIEmbeddings({
            apiKey: config.open_ai_key
        }), {
            collectionName: "all_appdata_embeddings",
            url: "http://localhost:8000",
        });
    }
    return vectorStore;
}

const getSearchResult = async (username, context, searchQuery) => {
    const vs = await getVectorStore();
    const retriever = vs.asRetriever();

    // Ensure prompt is formatted as a runnable or function
    const prompt = PromptTemplate.fromTemplate(`Use the following pieces of context to answer the Search Query at the end. Feel free to make up information about users or actors you know about 
    Personalize the reply to the username and who their friends are, and state the name of the user when replying. Answer questions with ANY and ALL knowledge of actors, users, posts, hashtags, etc. that you might have. Always say "thanks for asking!" at the end of the answer.
    
    ${context}

    More users database context:
    +--------+--------------------------+-----------+----------+--------------------------------------------------------------+-------------------------------+--------+----------------+-------------+---------------------+----------+---------------+-----------+----------------+--------------+---------------------+
| userID | username                 | firstName | lastName | salted_password                                              | emailID                       | actors | birthday       | affiliation | linked_actor_nconst | inviters | profilePicURL | userScore | userVisibility | sessionToken | lastOnline          |
+--------+--------------------------+-----------+----------+--------------------------------------------------------------+-------------------------------+--------+----------------+-------------+---------------------+----------+---------------+-----------+----------------+--------------+---------------------+
|      1 | user-Charles-Chaplin     | NULL      | NULL     | pass-Charles-Chaplin                                         | Charles-Chaplin@gmail.com     | NULL   | actor-birthday | actor       | nm0000122           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:41 |
|      2 | user-John-Ford           | NULL      | NULL     | pass-John-Ford                                               | John-Ford@gmail.com           | NULL   | actor-birthday | actor       | nm0000406           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:41 |
|      3 | user-DW-Griffith         | NULL      | NULL     | pass-DW-Griffith                                             | DW-Griffith@gmail.com         | NULL   | actor-birthday | actor       | nm0000428           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:42 |
|      4 | user-Theda-Bara          | NULL      | NULL     | pass-Theda-Bara                                              | Theda-Bara@gmail.com          | NULL   | actor-birthday | actor       | nm0000847           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:42 |
|      5 | user-John-Barrymore      | NULL      | NULL     | pass-John-Barrymore                                          | John-Barrymore@gmail.com      | NULL   | actor-birthday | actor       | nm0000858           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:42 |
|      6 | user-Lionel-Barrymore    | NULL      | NULL     | pass-Lionel-Barrymore                                        | Lionel-Barrymore@gmail.com    | NULL   | actor-birthday | actor       | nm0000859           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:42 |
|      7 | user-Wallace-Beery       | NULL      | NULL     | pass-Wallace-Beery                                           | Wallace-Beery@gmail.com       | NULL   | actor-birthday | actor       | nm0000891           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:43 |
|      8 | user-Oliver-Hardy        | NULL      | NULL     | pass-Oliver-Hardy                                            | Oliver-Hardy@gmail.com        | NULL   | actor-birthday | actor       | nm0001316           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:43 |
|      9 | user-Leslie-Howard       | NULL      | NULL     | pass-Leslie-Howard                                           | Leslie-Howard@gmail.com       | NULL   | actor-birthday | actor       | nm0001366           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:43 |
|     10 | user-Maurice-Chevalier   | NULL      | NULL     | pass-Maurice-Chevalier                                       | Maurice-Chevalier@gmail.com   | NULL   | actor-birthday | actor       | nm0002001           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:44 |
|     11 | user-Michael-Curtiz      | NULL      | NULL     | pass-Michael-Curtiz                                          | Michael-Curtiz@gmail.com      | NULL   | actor-birthday | actor       | nm0002031           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:44 |
|     12 | user-Alan-Hale           | NULL      | NULL     | pass-Alan-Hale                                               | Alan-Hale@gmail.com           | NULL   | actor-birthday | actor       | nm0002118           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:44 |
|     13 | user-Alfred-Abel         | NULL      | NULL     | pass-Alfred-Abel                                             | Alfred-Abel@gmail.com         | NULL   | actor-birthday | actor       | nm0002154           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:44 |
|     14 | user-Hans-Albers         | NULL      | NULL     | pass-Hans-Albers                                             | Hans-Albers@gmail.com         | NULL   | actor-birthday | actor       | nm0002161           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:45 |
|     15 | user-Erich-von-Stroheim  | NULL      | NULL     | pass-Erich-von-Stroheim                                      | Erich-von-Stroheim@gmail.com  | NULL   | actor-birthday | actor       | nm0002233           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:45 |
|     16 | user-Montagu-Love        | NULL      | NULL     | pass-Montagu-Love                                            | Montagu-Love@gmail.com        | NULL   | actor-birthday | actor       | nm0002311           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:45 |
|     17 | user-Moe-Howard          | NULL      | NULL     | pass-Moe-Howard                                              | Moe-Howard@gmail.com          | NULL   | actor-birthday | actor       | nm0002935           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:45 |
|     18 | user-Pedro-de-Cordoba    | NULL      | NULL     | pass-Pedro-de-Cordoba                                        | Pedro-de-Cordoba@gmail.com    | NULL   | actor-birthday | actor       | nm0003124           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:45 |
|     19 | user-Asta-Nielsen        | NULL      | NULL     | pass-Asta-Nielsen                                            | Asta-Nielsen@gmail.com        | NULL   | actor-birthday | actor       | nm0003425           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:46 |
|     20 | user-Lloyd-Bacon         | NULL      | NULL     | pass-Lloyd-Bacon                                             | Lloyd-Bacon@gmail.com         | NULL   | actor-birthday | actor       | nm0045800           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:46 |
|     21 | user-Lionel-Belmore      | NULL      | NULL     | pass-Lionel-Belmore                                          | Lionel-Belmore@gmail.com      | NULL   | actor-birthday | actor       | nm0069373           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:46 |
|     22 | user-Richard-Bennett     | NULL      | NULL     | pass-Richard-Bennett                                         | Richard-Bennett@gmail.com     | NULL   | actor-birthday | actor       | nm0071992           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:47 |
|     23 | user-Sarah-Bernhardt     | NULL      | NULL     | pass-Sarah-Bernhardt                                         | Sarah-Bernhardt@gmail.com     | NULL   | actor-birthday | actor       | nm0076800           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:47 |
|     24 | user-Francesca-Bertini   | NULL      | NULL     | pass-Francesca-Bertini                                       | Francesca-Bertini@gmail.com   | NULL   | actor-birthday | actor       | nm0078116           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:47 |
|     25 | user-Clara-Blandick      | NULL      | NULL     | pass-Clara-Blandick                                          | Clara-Blandick@gmail.com      | NULL   | actor-birthday | actor       | nm0087404           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:47 |
|     26 | user-Curt-Bois           | NULL      | NULL     | pass-Curt-Bois                                               | Curt-Bois@gmail.com           | NULL   | actor-birthday | actor       | nm0092290           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:48 |
|     27 | user-Frank-Borzage       | NULL      | NULL     | pass-Frank-Borzage                                           | Frank-Borzage@gmail.com       | NULL   | actor-birthday | actor       | nm0097648           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:48 |
|     28 | user-Hobart-Bosworth     | NULL      | NULL     | pass-Hobart-Bosworth                                         | Hobart-Bosworth@gmail.com     | NULL   | actor-birthday | actor       | nm0098376           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:48 |
|     29 | user-Alice-Brady         | NULL      | NULL     | pass-Alice-Brady                                             | Alice-Brady@gmail.com         | NULL   | actor-birthday | actor       | nm0103567           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:48 |
|     30 | user-Edmund-Breese       | NULL      | NULL     | pass-Edmund-Breese                                           | Edmund-Breese@gmail.com       | NULL   | actor-birthday | actor       | nm0106785           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:48 |
|     31 | user-Evelyn-Brent        | NULL      | NULL     | pass-Evelyn-Brent                                            | Evelyn-Brent@gmail.com        | NULL   | actor-birthday | actor       | nm0107574           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:49 |
|     32 | user-Tod-Browning        | NULL      | NULL     | pass-Tod-Browning                                            | Tod-Browning@gmail.com        | NULL   | actor-birthday | actor       | nm0115218           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:49 |
|     33 | user-Francis-X-Bushman   | NULL      | NULL     | pass-Francis-X-Bushman                                       | Francis-X-Bushman@gmail.com   | NULL   | actor-birthday | actor       | nm0124279           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:49 |
|     34 | user-Charley-Chase       | NULL      | NULL     | pass-Charley-Chase                                           | Charley-Chase@gmail.com       | NULL   | actor-birthday | actor       | nm0153713           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:50 |
|     35 | user-Marguerite-Clayton  | NULL      | NULL     | pass-Marguerite-Clayton                                      | Marguerite-Clayton@gmail.com  | NULL   | actor-birthday | actor       | nm0165744           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:50 |
|     36 | user-Edmund-Cobb         | NULL      | NULL     | pass-Edmund-Cobb                                             | Edmund-Cobb@gmail.com         | NULL   | actor-birthday | actor       | nm0167760           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:50 |
|     37 | user-Betty-Compson       | NULL      | NULL     | pass-Betty-Compson                                           | Betty-Compson@gmail.com       | NULL   | actor-birthday | actor       | nm0173993           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:50 |
|     38 | user-Chester-Conklin     | NULL      | NULL     | pass-Chester-Conklin                                         | Chester-Conklin@gmail.com     | NULL   | actor-birthday | actor       | nm0174682           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:50 |
|     39 | user-Jack-Conway         | NULL      | NULL     | pass-Jack-Conway                                             | Jack-Conway@gmail.com         | NULL   | actor-birthday | actor       | nm0176699           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:51 |
|     40 | user-Miriam-Cooper       | NULL      | NULL     | pass-Miriam-Cooper                                           | Miriam-Cooper@gmail.com       | NULL   | actor-birthday | actor       | nm0178270           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:51 |
|     41 | user-Dolores-Costello    | NULL      | NULL     | pass-Dolores-Costello                                        | Dolores-Costello@gmail.com    | NULL   | actor-birthday | actor       | nm0182537           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:51 |
|     42 | user-Donald-Crisp        | NULL      | NULL     | pass-Donald-Crisp                                            | Donald-Crisp@gmail.com        | NULL   | actor-birthday | actor       | nm0187981           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:51 |
|     43 | user-James-Cruze         | NULL      | NULL     | pass-James-Cruze                                             | James-Cruze@gmail.com         | NULL   | actor-birthday | actor       | nm0190516           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:51 |
|     44 | user-Viola-Dana          | NULL      | NULL     | pass-Viola-Dana                                              | Viola-Dana@gmail.com          | NULL   | actor-birthday | actor       | nm0199087           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:52 |
|     45 | user-Bebe-Daniels        | NULL      | NULL     | pass-Bebe-Daniels                                            | Bebe-Daniels@gmail.com        | NULL   | actor-birthday | actor       | nm0199841           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:52 |
|     46 | user-Marie-Dressler      | NULL      | NULL     | pass-Marie-Dressler                                          | Marie-Dressler@gmail.com      | NULL   | actor-birthday | actor       | nm0237597           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:52 |
|     47 | user-Thomas-A-Edison     | NULL      | NULL     | pass-Thomas-A-Edison                                         | Thomas-A-Edison@gmail.com     | NULL   | actor-birthday | actor       | nm0249379           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:52 |
|     48 | user-Dot-Farley          | NULL      | NULL     | pass-Dot-Farley                                              | Dot-Farley@gmail.com          | NULL   | actor-birthday | actor       | nm0267638           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:52 |
|     49 | user-Franklyn-Farnum     | NULL      | NULL     | pass-Franklyn-Farnum                                         | Franklyn-Farnum@gmail.com     | NULL   | actor-birthday | actor       | nm0267916           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:53 |
|     50 | user-Geraldine-Farrar    | NULL      | NULL     | pass-Geraldine-Farrar                                        | Geraldine-Farrar@gmail.com    | NULL   | actor-birthday | actor       | nm0268125           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:53 |
|     51 | user-Louise-Fazenda      | NULL      | NULL     | pass-Louise-Fazenda                                          | Louise-Fazenda@gmail.com      | NULL   | actor-birthday | actor       | nm0269771           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:53 |
|     52 | user-Margarita-Fischer   | NULL      | NULL     | pass-Margarita-Fischer                                       | Margarita-Fischer@gmail.com   | NULL   | actor-birthday | actor       | nm0279038           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:53 |
|     53 | user-Victor-Fleming      | NULL      | NULL     | pass-Victor-Fleming                                          | Victor-Fleming@gmail.com      | NULL   | actor-birthday | actor       | nm0281808           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:54 |
|     54 | user-Francis-Ford        | NULL      | NULL     | pass-Francis-Ford                                            | Francis-Ford@gmail.com        | NULL   | actor-birthday | actor       | nm0285643           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:54 |
|     55 | user-William-Frawley     | NULL      | NULL     | pass-William-Frawley                                         | William-Frawley@gmail.com     | NULL   | actor-birthday | actor       | nm0292433           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:54 |
|     56 | user-Pauline-Frederick   | NULL      | NULL     | pass-Pauline-Frederick                                       | Pauline-Frederick@gmail.com   | NULL   | actor-birthday | actor       | nm0292810           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:54 |
|     57 | user-Helen-Gibson        | NULL      | NULL     | pass-Helen-Gibson                                            | Helen-Gibson@gmail.com        | NULL   | actor-birthday | actor       | nm0316993           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:54 |
|     58 | user-Hoot-Gibson         | NULL      | NULL     | pass-Hoot-Gibson                                             | Hoot-Gibson@gmail.com         | NULL   | actor-birthday | actor       | nm0316995           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:55 |
|     59 | user-Dorothy-Gish        | NULL      | NULL     | pass-Dorothy-Gish                                            | Dorothy-Gish@gmail.com        | NULL   | actor-birthday | actor       | nm0321088           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:55 |
|     60 | user-Charley-Grapewin    | NULL      | NULL     | pass-Charley-Grapewin                                        | Charley-Grapewin@gmail.com    | NULL   | actor-birthday | actor       | nm0335788           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:55 |
|     61 | user-Creighton-Hale      | NULL      | NULL     | pass-Creighton-Hale                                          | Creighton-Hale@gmail.com      | NULL   | actor-birthday | actor       | nm0354878           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:56 |
|     62 | user-Otis-Harlan         | NULL      | NULL     | pass-Otis-Harlan                                             | Otis-Harlan@gmail.com         | NULL   | actor-birthday | actor       | nm0363227           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:56 |
|     63 | user-Mildred-Harris      | NULL      | NULL     | pass-Mildred-Harris                                          | Mildred-Harris@gmail.com      | NULL   | actor-birthday | actor       | nm0365121           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:57 |
|     64 | user-Robert-Harron       | NULL      | NULL     | pass-Robert-Harron                                           | Robert-Harron@gmail.com       | NULL   | actor-birthday | actor       | nm0366008           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:57 |
|     65 | user-William-S-Hart      | NULL      | NULL     | pass-William-S-Hart                                          | William-S-Hart@gmail.com      | NULL   | actor-birthday | actor       | nm0366586           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:57 |
|     66 | user-Raymond-Hatton      | NULL      | NULL     | pass-Raymond-Hatton                                          | Raymond-Hatton@gmail.com      | NULL   | actor-birthday | actor       | nm0369058           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:57 |
|     67 | user-Sessue-Hayakawa     | NULL      | NULL     | pass-Sessue-Hayakawa                                         | Sessue-Hayakawa@gmail.com     | NULL   | actor-birthday | actor       | nm0370564           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:58 |
|     68 | user-Dell-Henderson      | NULL      | NULL     | pass-Dell-Henderson                                          | Dell-Henderson@gmail.com      | NULL   | actor-birthday | actor       | nm0376396           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:58 |
|     69 | user-Jean-Hersholt       | NULL      | NULL     | pass-Jean-Hersholt                                           | Jean-Hersholt@gmail.com       | NULL   | actor-birthday | actor       | nm0380965           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:58 |
|     70 | user-Howard-Hickman      | NULL      | NULL     | pass-Howard-Hickman                                          | Howard-Hickman@gmail.com      | NULL   | actor-birthday | actor       | nm0382730           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:58 |
|     71 | user-Russell-Hicks       | NULL      | NULL     | pass-Russell-Hicks                                           | Russell-Hicks@gmail.com       | NULL   | actor-birthday | actor       | nm0382954           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:58 |
|     72 | user-Jack-Holt           | NULL      | NULL     | pass-Jack-Holt                                               | Jack-Holt@gmail.com           | NULL   | actor-birthday | actor       | nm0392442           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:59 |
|     73 | user-Arthur-Hoyt         | NULL      | NULL     | pass-Arthur-Hoyt                                             | Arthur-Hoyt@gmail.com         | NULL   | actor-birthday | actor       | nm0398446           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:59 |
|     74 | user-Si-Jenks            | NULL      | NULL     | pass-Si-Jenks                                                | Si-Jenks@gmail.com            | NULL   | actor-birthday | actor       | nm0421041           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:59 |
|     75 | user-Buck-Jones          | NULL      | NULL     | pass-Buck-Jones                                              | Buck-Jones@gmail.com          | NULL   | actor-birthday | actor       | nm0427659           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:22:59 |
|     76 | user-Leatrice-Joy        | NULL      | NULL     | pass-Leatrice-Joy                                            | Leatrice-Joy@gmail.com        | NULL   | actor-birthday | actor       | nm0431433           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:00 |
|     77 | user-Alice-Joyce         | NULL      | NULL     | pass-Alice-Joyce                                             | Alice-Joyce@gmail.com         | NULL   | actor-birthday | actor       | nm0431484           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:00 |
|     78 | user-Edgar-Kennedy       | NULL      | NULL     | pass-Edgar-Kennedy                                           | Edgar-Kennedy@gmail.com       | NULL   | actor-birthday | actor       | nm0448012           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:00 |
|     79 | user-Doris-Kenyon        | NULL      | NULL     | pass-Doris-Kenyon                                            | Doris-Kenyon@gmail.com        | NULL   | actor-birthday | actor       | nm0448987           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:00 |
|     80 | user-James-Kirkwood      | NULL      | NULL     | pass-James-Kirkwood                                          | James-Kirkwood@gmail.com      | NULL   | actor-birthday | actor       | nm0456804           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:01 |
|     81 | user-Henry-Kolker        | NULL      | NULL     | pass-Henry-Kolker                                            | Henry-Kolker@gmail.com        | NULL   | actor-birthday | actor       | nm0464137           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:01 |
|     82 | user-Bob-Kortman         | NULL      | NULL     | pass-Bob-Kortman                                             | Bob-Kortman@gmail.com         | NULL   | actor-birthday | actor       | nm0466773           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:01 |
|     83 | user-Werner-Krauss       | NULL      | NULL     | pass-Werner-Krauss                                           | Werner-Krauss@gmail.com       | NULL   | actor-birthday | actor       | nm0470328           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:01 |
|     84 | user-Florence-La-Badie   | NULL      | NULL     | pass-Florence-La-Badie                                       | Florence-La-Badie@gmail.com   | NULL   | actor-birthday | actor       | nm0478359           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:02 |
|     85 | user-David-Landau        | NULL      | NULL     | pass-David-Landau                                            | David-Landau@gmail.com        | NULL   | actor-birthday | actor       | nm0484439           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:02 |
|     86 | user-Florence-Lawrence   | NULL      | NULL     | pass-Florence-Lawrence                                       | Florence-Lawrence@gmail.com   | NULL   | actor-birthday | actor       | nm0492757           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:02 |
|     87 | user-Robert-Z-Leonard    | NULL      | NULL     | pass-Robert-Z-Leonard                                        | Robert-Z-Leonard@gmail.com    | NULL   | actor-birthday | actor       | nm0502752           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:02 |
|     88 | user-Elmo-Lincoln        | NULL      | NULL     | pass-Elmo-Lincoln                                            | Elmo-Lincoln@gmail.com        | NULL   | actor-birthday | actor       | nm0511104           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:02 |
|     89 | user-Frank-Lloyd         | NULL      | NULL     | pass-Frank-Lloyd                                             | Frank-Lloyd@gmail.com         | NULL   | actor-birthday | actor       | nm0515979           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:03 |
|     90 | user-Harold-Lloyd        | NULL      | NULL     | pass-Harold-Lloyd                                            | Harold-Lloyd@gmail.com        | NULL   | actor-birthday | actor       | nm0516001           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:03 |
|     91 | user-Ernst-Lubitsch      | NULL      | NULL     | pass-Ernst-Lubitsch                                          | Ernst-Lubitsch@gmail.com      | NULL   | actor-birthday | actor       | nm0523932           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:03 |
|     92 | user-Wilfred-Lucas       | NULL      | NULL     | pass-Wilfred-Lucas                                           | Wilfred-Lucas@gmail.com       | NULL   | actor-birthday | actor       | nm0524306           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:03 |
|     93 | user-Marc-McDermott      | NULL      | NULL     | pass-Marc-McDermott                                          | Marc-McDermott@gmail.com      | NULL   | actor-birthday | actor       | nm0531584           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:03 |
|     94 | user-J-Farrell-MacDonald | NULL      | NULL     | pass-J-Farrell-MacDonald                                     | J-Farrell-MacDonald@gmail.com | NULL   | actor-birthday | actor       | nm0531759           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:04 |
|     95 | user-Mae-Marsh           | NULL      | NULL     | pass-Mae-Marsh                                               | Mae-Marsh@gmail.com           | NULL   | actor-birthday | actor       | nm0550615           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:04 |
|     96 | user-Tully-Marshall      | NULL      | NULL     | pass-Tully-Marshall                                          | Tully-Marshall@gmail.com      | NULL   | actor-birthday | actor       | nm0551222           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:04 |
|     97 | user-Vivian-Martin       | NULL      | NULL     | pass-Vivian-Martin                                           | Vivian-Martin@gmail.com       | NULL   | actor-birthday | actor       | nm0553184           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:04 |
|     98 | user-Francis-McDonald    | NULL      | NULL     | pass-Francis-McDonald                                        | Francis-McDonald@gmail.com    | NULL   | actor-birthday | actor       | nm0567756           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:04 |
|     99 | user-Lafe-McKee          | NULL      | NULL     | pass-Lafe-McKee                                              | Lafe-McKee@gmail.com          | NULL   | actor-birthday | actor       | nm0571186           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:05 |
|    100 | user-Thomas-Meighan      | NULL      | NULL     | pass-Thomas-Meighan                                          | Thomas-Meighan@gmail.com      | NULL   | actor-birthday | actor       | nm0576762           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:05 |
|    101 | user-Mary-Miles-Minter   | NULL      | NULL     | pass-Mary-Miles-Minter                                       | Mary-Miles-Minter@gmail.com   | NULL   | actor-birthday | actor       | nm0591704           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:05 |
|    102 | user-Tom-Mix             | NULL      | NULL     | pass-Tom-Mix                                                 | Tom-Mix@gmail.com             | NULL   | actor-birthday | actor       | nm0594291           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:05 |
|    103 | user-Owen-Moore          | NULL      | NULL     | pass-Owen-Moore                                              | Owen-Moore@gmail.com          | NULL   | actor-birthday | actor       | nm0601698           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:06 |
|    104 | user-Lee-Moran           | NULL      | NULL     | pass-Lee-Moran                                               | Lee-Moran@gmail.com           | NULL   | actor-birthday | actor       | nm0602905           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:06 |
|    105 | user-Antonio-Moreno      | NULL      | NULL     | pass-Antonio-Moreno                                          | Antonio-Moreno@gmail.com      | NULL   | actor-birthday | actor       | nm0603875           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:06 |
|    106 | user-Anna-Q-Nilsson      | NULL      | NULL     | pass-Anna-Q-Nilsson                                          | Anna-Q-Nilsson@gmail.com      | NULL   | actor-birthday | actor       | nm0632160           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:06 |
|    107 | user-Bud-Osborne         | NULL      | NULL     | pass-Bud-Osborne                                             | Bud-Osborne@gmail.com         | NULL   | actor-birthday | actor       | nm0651627           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:07 |
|    108 | user-Eugene-Pallette     | NULL      | NULL     | pass-Eugene-Pallette                                         | Eugene-Pallette@gmail.com     | NULL   | actor-birthday | actor       | nm0657874           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:07 |
|    109 | user-Paul-Panzer         | NULL      | NULL     | pass-Paul-Panzer                                             | Paul-Panzer@gmail.com         | NULL   | actor-birthday | actor       | nm0659947           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:07 |
|    110 | user-Louella-Parsons     | NULL      | NULL     | pass-Louella-Parsons                                         | Louella-Parsons@gmail.com     | NULL   | actor-birthday | actor       | nm0663860           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:07 |
|    111 | user-Dorothy-Phillips    | NULL      | NULL     | pass-Dorothy-Phillips                                        | Dorothy-Phillips@gmail.com    | NULL   | actor-birthday | actor       | nm0680368           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:07 |
|    112 | user-Jack-Pickford       | NULL      | NULL     | pass-Jack-Pickford                                           | Jack-Pickford@gmail.com       | NULL   | actor-birthday | actor       | nm0681927           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:08 |
|    113 | user-Mary-Pickford       | NULL      | NULL     | pass-Mary-Pickford                                           | Mary-Pickford@gmail.com       | NULL   | actor-birthday | actor       | nm0681933           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:08 |
|    114 | user-Edna-Purviance      | NULL      | NULL     | pass-Edna-Purviance                                          | Edna-Purviance@gmail.com      | NULL   | actor-birthday | actor       | nm0701012           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:08 |
|    115 | user-Raimu               | NULL      | NULL     | pass-Raimu                                                   | Raimu@gmail.com               | NULL   | actor-birthday | actor       | nm0706926           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:08 |
|    116 | user-Wallace-Reid        | NULL      | NULL     | pass-Wallace-Reid                                            | Wallace-Reid@gmail.com        | NULL   | actor-birthday | actor       | nm0717468           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:08 |
|    117 | user-Elisabeth-Risdon    | NULL      | NULL     | pass-Elisabeth-Risdon                                        | Elisabeth-Risdon@gmail.com    | NULL   | actor-birthday | actor       | nm0728230           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:09 |
|    118 | user-Mack-Sennett        | NULL      | NULL     | pass-Mack-Sennett                                            | Mack-Sennett@gmail.com        | NULL   | actor-birthday | actor       | nm0784407           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:09 |
|    119 | user-Lowell-Sherman      | NULL      | NULL     | pass-Lowell-Sherman                                          | Lowell-Sherman@gmail.com      | NULL   | actor-birthday | actor       | nm0792514           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:09 |
|    120 | user-Phillips-Smalley    | NULL      | NULL     | pass-Phillips-Smalley                                        | Phillips-Smalley@gmail.com    | NULL   | actor-birthday | actor       | nm0806565           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:09 |
|    121 | user-C-Aubrey-Smith      | NULL      | NULL     | pass-C-Aubrey-Smith                                          | C-Aubrey-Smith@gmail.com      | NULL   | actor-birthday | actor       | nm0807580           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:10 |
|    122 | user-Al-St-John          | NULL      | NULL     | pass-Al-St-John                                              | Al-St-John@gmail.com          | NULL   | actor-birthday | actor       | nm0820607           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:10 |
|    123 | user-Charles-Starrett    | NULL      | NULL     | pass-Charles-Starrett                                        | Charles-Starrett@gmail.com    | NULL   | actor-birthday | actor       | nm0823633           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:10 |
|    124 | user-Anita-Stewart       | NULL      | NULL     | pass-Anita-Stewart                                           | Anita-Stewart@gmail.com       | NULL   | actor-birthday | actor       | nm0829171           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:10 |
|    125 | user-Slim-Summerville    | NULL      | NULL     | pass-Slim-Summerville                                        | Slim-Summerville@gmail.com    | NULL   | actor-birthday | actor       | nm0838843           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:11 |
|    126 | user-Gloria-Swanson      | NULL      | NULL     | pass-Gloria-Swanson                                          | Gloria-Swanson@gmail.com      | NULL   | actor-birthday | actor       | nm0841797           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:11 |
|    127 | user-Blanche-Sweet       | NULL      | NULL     | pass-Blanche-Sweet                                           | Blanche-Sweet@gmail.com       | NULL   | actor-birthday | actor       | nm0842239           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:11 |
|    128 | user-Constance-Talmadge  | NULL      | NULL     | pass-Constance-Talmadge                                      | Constance-Talmadge@gmail.com  | NULL   | actor-birthday | actor       | nm0848226           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:11 |
|    129 | user-Norma-Talmadge      | NULL      | NULL     | pass-Norma-Talmadge                                          | Norma-Talmadge@gmail.com      | NULL   | actor-birthday | actor       | nm0848232           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:11 |
|    130 | user-Genevieve-Tobin     | NULL      | NULL     | pass-Genevieve-Tobin                                         | Genevieve-Tobin@gmail.com     | NULL   | actor-birthday | actor       | nm0864931           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:12 |
|    131 | user-Richard-Tucker      | NULL      | NULL     | pass-Richard-Tucker                                          | Richard-Tucker@gmail.com      | NULL   | actor-birthday | actor       | nm0875983           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:12 |
|    132 | user-Ben-Turpin          | NULL      | NULL     | pass-Ben-Turpin                                              | Ben-Turpin@gmail.com          | NULL   | actor-birthday | actor       | nm0878035           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:12 |
|    133 | user-Robert-Vaughn       | NULL      | NULL     | pass-Robert-Vaughn                                           | Robert-Vaughn@gmail.com       | NULL   | actor-birthday | actor       | nm0891238           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:12 |
|    134 | user-Raoul-Walsh         | NULL      | NULL     | pass-Raoul-Walsh                                             | Raoul-Walsh@gmail.com         | NULL   | actor-birthday | actor       | nm0909825           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:12 |
|    135 | user-Henry-B-Walthall    | NULL      | NULL     | pass-Henry-B-Walthall                                        | Henry-B-Walthall@gmail.com    | NULL   | actor-birthday | actor       | nm0910400           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:13 |
|    136 | user-HB-Warner           | NULL      | NULL     | pass-HB-Warner                                               | HB-Warner@gmail.com           | NULL   | actor-birthday | actor       | nm0912478           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:13 |
|    137 | user-Minor-Watson        | NULL      | NULL     | pass-Minor-Watson                                            | Minor-Watson@gmail.com        | NULL   | actor-birthday | actor       | nm0914808           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:13 |
|    138 | user-Lois-Weber          | NULL      | NULL     | pass-Lois-Weber                                              | Lois-Weber@gmail.com          | NULL   | actor-birthday | actor       | nm0916665           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:14 |
|    139 | user-Paul-Wegener        | NULL      | NULL     | pass-Paul-Wegener                                            | Paul-Wegener@gmail.com        | NULL   | actor-birthday | actor       | nm0917467           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:14 |
|    140 | user-Leo-White           | NULL      | NULL     | pass-Leo-White                                               | Leo-White@gmail.com           | NULL   | actor-birthday | actor       | nm0925118           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:14 |
|    141 | user-Pearl-White         | NULL      | NULL     | pass-Pearl-White                                             | Pearl-White@gmail.com         | NULL   | actor-birthday | actor       | nm0925310           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:14 |
|    142 | user-May-Whitty          | NULL      | NULL     | pass-May-Whitty                                              | May-Whitty@gmail.com          | NULL   | actor-birthday | actor       | nm0926599           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:14 |
|    143 | user-Crane-Wilbur        | NULL      | NULL     | pass-Crane-Wilbur                                            | Crane-Wilbur@gmail.com        | NULL   | actor-birthday | actor       | nm0928108           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:15 |
|    144 | user-Clara-Williams      | NULL      | NULL     | pass-Clara-Williams                                          | Clara-Williams@gmail.com      | NULL   | actor-birthday | actor       | nm0930290           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:15 |
|    145 | user-Clara-Kimball-Young | NULL      | NULL     | pass-Clara-Kimball-Young                                     | Clara-Kimball-Young@gmail.com | NULL   | actor-birthday | actor       | nm0949403           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:23:15 |
|    146 | testUser12345            | NULL      | NULL     | $2b$10$wCXuak0z9lbPxxiwgZQdaev71w.DX02IYtoTSUIOsdAcqUylzYtsW | testemail@gmail.com           | NULL   | 01-01-01       | Penn        | NULL                |     NULL | NULL          |      NULL |                | NULL         | 2024-05-13 14:38:42 |
|    147 | user-Charles-Chaplin     | NULL      | NULL     | pass-Charles-Chaplin                                         | Charles-Chaplin@gmail.com     | NULL   | actor-birthday | actor       | nm0000122           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:48:30 |
|    148 | user-John-Ford           | NULL      | NULL     | pass-John-Ford                                               | John-Ford@gmail.com           | NULL   | actor-birthday | actor       | nm0000406           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:48:30 |
|    149 | user-DW-Griffith         | NULL      | NULL     | pass-DW-Griffith                                             | DW-Griffith@gmail.com         | NULL   | actor-birthday | actor       | nm0000428           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:48:30 |
|    150 | user-Theda-Bara          | NULL      | NULL     | pass-Theda-Bara                                              | Theda-Bara@gmail.com          | NULL   | actor-birthday | actor       | nm0000847           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:48:31 |
|    151 | user-John-Barrymore      | NULL      | NULL     | pass-John-Barrymore                                          | John-Barrymore@gmail.com      | NULL   | actor-birthday | actor       | nm0000858           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:48:31 |
|    152 | user-Lionel-Barrymore    | NULL      | NULL     | pass-Lionel-Barrymore                                        | Lionel-Barrymore@gmail.com    | NULL   | actor-birthday | actor       | nm0000859           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:48:31 |
|    153 | user-Wallace-Beery       | NULL      | NULL     | pass-Wallace-Beery                                           | Wallace-Beery@gmail.com       | NULL   | actor-birthday | actor       | nm0000891           |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:48:31 |
|    154 | alainTest                | NULL      | NULL     | $2b$10$hPZuvFE6P9jgqeKBpk0Ei.2dj9Z/JPHJe9wt6DDiQEBRzDuBrZsQm | alainw@seas.upenn.edu         | NULL   | 0010-10-10     | Penn        | NULL                |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 14:55:35 |
|    155 | SemMain                  | NULL      | NULL     | $2b$10$2HxMP.qK2foA4JM0CySq7u60tfcD3TorLP8EQGKzhn7tk9Rh5zu1q | semf@seas.upenn.edu           | NULL   | 2024-05-01     | Penn        | NULL                |     NULL | NULL          |      NULL | public         | NULL         | 2024-05-13 15:58:57 |
+--------+--------------------------+-----------+----------+--------------------------------------------------------------+-------------------------------+--------+----------------+-------------+---------------------+----------+---------------+-----------+----------------+--------------+---------------------+
155 rows in set (0.02 sec)


    For user with username: ${username}
    
    Search Query: ${searchQuery}
        
    Helpful Answer:`);
    const llm = new ChatOpenAI({
        apiKey: config.open_ai_key,
        model: "gpt-3.5-turbo-16k-0613",
        temperature: 0
    });

    const ragChain = RunnableSequence.from([
        {
            context: retriever.pipe(formatDocumentsAsString),
            question: new RunnablePassthrough(),
          },
      prompt,
      llm,
      new StringOutputParser(),
    ]);

    let result = await ragChain.invoke(searchQuery);

    return result;
}

export default getSearchResult;
